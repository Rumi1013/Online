{%- comment -%}
  Collection template for displaying products in a collection
{%- endcomment -%}

<div class="collection-page">
  <div class="container">
    {%- comment -%} Collection Header {%- endcomment -%}
    <div class="collection-header animate-fade-in">
      {%- if collection.image -%}
        <div class="collection-hero-image">
          <img 
            src="{{ collection.image | image_url: width: 1200 }}"
            alt="{{ collection.image.alt | default: collection.title | escape }}"
            loading="lazy"
            class="collection-image"
          >
        </div>
      {%- endif -%}
      
      <div class="collection-info">
        <h1 class="collection-title">{{ collection.title }}</h1>
        {%- if collection.description != blank -%}
          <div class="collection-description">
            {{ collection.description }}
          </div>
        {%- endif -%}
        <p class="collection-count">{{ collection.products_count }} sacred tools</p>
      </div>
    </div>

    {%- comment -%} Filtering and Sorting {%- endcomment -%}
    <div class="collection-filters animate-fade-in-up">
      <div class="filters-row">
        <div class="filter-group">
          <label for="sort-by">Sort by:</label>
          <select id="sort-by" class="sort-select">
            <option value="manual">Featured</option>
            <option value="best-selling">Best Selling</option>
            <option value="title-ascending">A-Z</option>
            <option value="title-descending">Z-A</option>
            <option value="price-ascending">Price: Low to High</option>
            <option value="price-descending">Price: High to Low</option>
            <option value="created-ascending">Oldest First</option>
            <option value="created-descending">Newest First</option>
          </select>
        </div>
        
        <div class="results-count">
          Showing {{ collection.products.size }} of {{ collection.products_count }} products
        </div>
      </div>
    </div>

    {%- comment -%} Products Grid {%- endcomment -%}
    <div class="collection-products animate-fade-in-up" style="animation-delay: 0.2s;">
      {%- if collection.products.size > 0 -%}
        <div class="products-grid">
          {%- for product in collection.products -%}
            {% render 'product-card', product: product, show_vendor: settings.show_vendor, lazy_load: true %}
          {%- endfor -%}
        </div>

        {%- comment -%} Pagination {%- endcomment -%}
        {%- if paginate.pages > 1 -%}
          <nav class="pagination" role="navigation" aria-label="Pagination Navigation">
            <div class="pagination__inner">
              {%- if paginate.previous -%}
                <a href="{{ paginate.previous.url }}" class="pagination__item pagination__item--prev" aria-label="Previous page">
                  ← Previous
                </a>
              {%- endif -%}

              {%- for part in paginate.parts -%}
                {%- if part.is_link -%}
                  <a href="{{ part.url }}" class="pagination__item" aria-label="Page {{ part.title }}">
                    {{ part.title }}
                  </a>
                {%- else -%}
                  {%- if part.title == paginate.current_page -%}
                    <span class="pagination__item pagination__item--current" aria-current="page" aria-label="Page {{ part.title }}">
                      {{ part.title }}
                    </span>
                  {%- else -%}
                    <span class="pagination__item pagination__item--gap">{{ part.title }}</span>
                  {%- endif -%}
                {%- endif -%}
              {%- endfor -%}

              {%- if paginate.next -%}
                <a href="{{ paginate.next.url }}" class="pagination__item pagination__item--next" aria-label="Next page">
                  Next →
                </a>
              {%- endif -%}
            </div>
          </nav>
        {%- endif -%}
      {%- else -%}
        <div class="collection-empty">
          <h2>No products found</h2>
          <p>This collection is currently empty or all products are out of stock.</p>
          <a href="{{ routes.all_products_collection_url }}" class="btn btn--primary">
            Browse All Products
          </a>
        </div>
      {%- endif -%}
    </div>
  </div>
</div>

<script>
  // Sort functionality
  document.addEventListener('DOMContentLoaded', function() {
    const sortSelect = document.getElementById('sort-by');
    if (sortSelect) {
      sortSelect.addEventListener('change', function() {
        const sortValue = this.value;
        const url = new URL(window.location.href);
        if (sortValue === 'manual') {
          url.searchParams.delete('sort_by');
        } else {
          url.searchParams.set('sort_by', sortValue);
        }
        window.location.href = url.toString();
      });
      
      // Set current sort value
      const urlParams = new URLSearchParams(window.location.search);
      const currentSort = urlParams.get('sort_by') || 'manual';
      sortSelect.value = currentSort;
    }
  });
</script>

{%- paginate collection.products by 24 -%}
  {%- comment -%} The pagination logic is handled above {%- endcomment -%}
{%- endpaginate -%}